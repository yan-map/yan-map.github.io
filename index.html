<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>Карта Яна</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.css' rel='stylesheet' />
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
 <style>
#menu {
background: #fff;
position: absolute;
z-index: 1;
top: 10px;
right: 10px;
border-radius: 6px;
border: 1px solid rgba(0,0,0,0.4);
font-family: 'Open Sans', sans-serif;
}
 
#menu a {
font-size: 13px;
color: #404040;
display: block;
margin: 0;
border-radius: 5px;
padding: 0;
padding: 10px;
text-decoration: none;
border-bottom: 1px solid rgba(0,0,0,0.25);
text-align: center;
}
 
#menu a:last-child {
border-radius: 5px;
border: none;
}
 
#menu a:hover {
background-color: #f8f8f8;
color: #404040;
}
 
#menu a.active {
background-color: #3887be;
border-radius: 5px;
color: #ffffff;
}
 
#menu a.active:hover {
border-radius: 5px;
background: #3074a4;
}
</style>
 
<nav id="menu"></nav>
<div id="map"></div>
 
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoieWFucG9ndXRzYSIsImEiOiJjajBhMzJydzIwZmtmMndvY3ozejFicTdqIn0.T6DCFk1BSoEkdG-2agIoQQ';
var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/yanpogutsa/cjyew8t4u0v101cp9wknt7okd',
center: [37.622232, 55.7436618],
minZoom: 2,
zoom: 10
});
 
map.on('load', function() {
map.addLayer({
id: 'Спутник',
source: {"type": "raster",  "url": "mapbox://mapbox.satellite", "tileSize": 256},
type: "raster",
layout: { 'visibility': 'none'},
}, 'tram');
// Add the source to query. In this example we're using
// county polygons uploaded as vector tiles
map.addLayer({
"id": "ngpt",
"type": "line",
"source": {
type: 'vector',
url: 'mapbox://yanpogutsa.dp8fgjzc'
},
"source-layer": "routes-3apr3n",
"layout": {
"line-join": "round",
"line-cap": "round"
},
"paint": {
"line-color": "rgba(0,0,0,0.2)",
"line-width":0
},
}); // Place polygon under these labels.

map.addLayer({
"id": "text-highlighted",
"type": "symbol",
"source": {
type: 'vector',
url: 'mapbox://yanpogutsa.dp8fgjzc'
},
"source-layer": "routes-3apr3n",
"layout": {
"text-field": ["to-string", ["get", "ref"]],
"text-size": 8,
"symbol-placement": "line",
"text-offset": [0, 1],
"text-font": [
  "Open Sans Bold",
  "Arial Unicode MS Regular"
]
},
"paint": {
"text-color": [
  "interpolate",
  ["linear"],
  ["get", "color"],
  1,
  "#006ff7",
  1.75,
  "#484848",
  2.5,
  "#ffc33c",
  4,
  "#ff5575"
],
}, "filter": ["in", "fid", ""]
}); // Place polygon under these labels.

map.addLayer({
"id": "ngpt-highlighted",
"type": "line",
"source": {
type: 'vector',
url: 'mapbox://yanpogutsa.dp8fgjzc'
},
"source-layer": "routes-3apr3n",
"layout": {
"line-join": "round",
"line-cap": "round",
},
"paint": {
"line-color": [
  "interpolate",
  ["linear"],
  ["get", "color"],
  1,
  "#006ff7",
  1.75,
  "#484848",
  2.5,
  "#ffc33c",
  4,
  "#ff5575"
],
"line-width": 1,
"line-dasharray": [2, 2],
"line-gap-width": 1
},
"filter": ["in", "fid", ""]
},); // Place polygon under these labels.

map.addLayer({
"id": "ngpt-pass",
"type": "circle",
"source": {
type: 'vector',
url: 'mapbox://yanpogutsa.4f2h0yzc'
},
"source-layer": "ngpt-pass-18g3e0",
"layout": {
"visibility": "none",
},
"paint": {
"circle-color": "hsla(213, 100%, 48%, 0.2)",
"circle-radius": [
  "interpolate",
  [
    "cubic-bezier",
    0.3,
    1,
    1,
    1
  ],
  [
    "get",
    "pass"
  ],
  0,
  15,
  11832,
  80
]
},
"minzoom": 13
}); // Place polygon under these labels.

map.addLayer({
"id": "ngpt-pass-text",
"type": "symbol",
"source": {
type: 'vector',
url: 'mapbox://yanpogutsa.4f2h0yzc'
},
"source-layer": "ngpt-pass-18g3e0",
"layout": {
"visibility": "none",
"text-field": [
  "to-string",
  [
    "get",
    "pass"
  ]
],
"text-size": 8,
"symbol-placement": "point",
"text-offset": [
  "interpolate",
  [
    "cubic-bezier",
    0.3,
    1,
    1,
    1
  ],
  [
    "get",
    "pass"
  ],
  1,
  ["literal", [0, 1]],
  11832,
  ["literal", [0, 5]]
],
"text-font": [
  "DIN Offc Pro Medium",
  "Arial Unicode MS Regular"
],
"icon-allow-overlap": true,
"icon-ignore-placement": true,
},
"paint": {
"text-color": "#006ef5",
"text-halo-color":"hsla(0, 0%, 100%, 0.5)",
"text-halo-width": 1.5
},
"minzoom": 13
},); // Place polygon under these labels.


});

var toggleableLayerIds = [ 'Спутник' ];
 
for (var i = 0; i < toggleableLayerIds.length; i++) {
var id = toggleableLayerIds[i];
 
var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = id;
 
link.onclick = function (e) {
var clickedLayer = this.textContent;
e.preventDefault();
e.stopPropagation();
 
var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
 
if (visibility === 'none') {
map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
this.className = '';
} else {
this.className = 'active';
map.setLayoutProperty(clickedLayer, 'visibility', 'none');
}
};
 
var layers = document.getElementById('menu');
layers.appendChild(link);
};
map.on('click', 'MCD-stations', function (e) {
new mapboxgl.Popup()
.setLngLat(e.lngLat)
.setHTML('<h3>'+e.features[0].properties.name+'</h3>'+'<p>Пасспоток 2018: ' + e.features[0].properties.Pass2018 + '</p>Пасспоток 2020: ' + e.features[0].properties.Pass2020 + '</p>'+ '</p>Пасспоток 2025: ' + e.features[0].properties.Pass2025 + '</p>')
.addTo(map);
});
// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'MCD-stations', function () {
map.getCanvas().style.cursor = 'pointer';
});
 
// Change it back to a pointer when it leaves.
map.on('mouseleave', 'MCD-stations', function () {
map.getCanvas().style.cursor = '';
});

var popup = new mapboxgl.Popup()
 

map.on('click', 'places-5y0blc', function (e) { popup.setLngLat(e.lngLat)
.setHTML('<h3>'+e.features[0].properties.StationName+'</h3>'+'<p>Маршруты: ' + e.features[0].properties.RouteNumbers + '</p>')
.addTo(map);});
// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'places-5y0blc', function () {
map.getCanvas().style.cursor = 'pointer';
});

// Change it back to a pointer when it leaves.
map.on('mouseleave', 'places-5y0blc', function () {
map.getCanvas().style.cursor = '';
});

map.on('click', 'places-5y0blc', function(e) {
// set bbox as 5px reactangle area around clicked point
var bbox = [[e.point.x - 20, e.point.y - 20], [e.point.x + 20, e.point.y + 20]];
var features = map.queryRenderedFeatures(bbox, { layers: ['ngpt'] });
 
// Run through the selected features and set a filter
// to match features with unique FIPS codes to activate
// the `counties-highlighted` layer.
var filter = features.reduce(function(memo, feature) {
memo.push(feature.properties.fid);
return memo;
}, ['in', 'fid']);
 
map.setFilter("ngpt-highlighted", filter);
map.setFilter("text-highlighted", filter);

map.setLayoutProperty('metro-lines','visibility','none');
map.setLayoutProperty('metro-lines-constructing','visibility','none');
map.setLayoutProperty('MCC copy','visibility','none');
map.setLayoutProperty('MCC','visibility','none');
map.setLayoutProperty('MCD-lines','visibility','none');

map.setLayoutProperty('metro-lines-copy','visibility','visible');
map.setLayoutProperty('metro-lines-constructing copy','visibility','visible');
map.setLayoutProperty('MCC copy 1','visibility','visible');
map.setLayoutProperty('MCD-lines copy 1','visibility','visible');
map.setLayoutProperty('ngpt-pass','visibility','visible');
map.setLayoutProperty('ngpt-pass-text','visibility','visible');
});



//map.on('click', 'ngpt-highlighted', function(e) {
// set bbox as 5px reactangle area around clicked point

popup.on('close', function(e) {
map.setFilter("ngpt-highlighted", ["in", "fid", ""]);
map.setFilter("text-highlighted", ["in", "fid", ""]);

map.setLayoutProperty('metro-lines','visibility','visible');
map.setLayoutProperty('metro-lines-constructing','visibility','visible');
map.setLayoutProperty('MCC copy','visibility','visible');
map.setLayoutProperty('MCC','visibility','visible');
map.setLayoutProperty('MCD-lines','visibility','visible');

map.setLayoutProperty('metro-lines-copy','visibility','none');
map.setLayoutProperty('metro-lines-constructing copy','visibility','none');
map.setLayoutProperty('MCC copy 1','visibility','none');
map.setLayoutProperty('MCD-lines copy 1','visibility','none');
map.setLayoutProperty('ngpt-pass','visibility','none');
map.setLayoutProperty('ngpt-pass-text','visibility','none');
});

</script>
 
</body>
</html>
